"use strict";
Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
const node_stream = require("node:stream");
const http = require("vinxi/http");
const fetcher = require("../client-runtime/fetcher.cjs");
const getBaseUrl = require("../client-runtime/getBaseUrl.cjs");
const index = require("../server-handler/index.cjs");
function createIncomingMessage(url, method, headers) {
  const readable = new node_stream.Readable({ objectMode: true });
  readable._read = () => {
  };
  readable.url = url;
  readable.method = method;
  readable.headers = headers;
  readable.connection = {};
  readable.getHeaders = () => {
    return headers;
  };
  return readable;
}
function createServerReference(_fn, id, name) {
  const functionUrl = getBaseUrl.getBaseUrl("http://localhost:3000", id, name);
  const proxyFn = (...args) => fetcher.fetcher(functionUrl, args, async (request) => {
    const event = http.getEvent();
    const ogRequestHeaders = http.getRequestHeaders(event);
    Object.entries(ogRequestHeaders).forEach(([key, value]) => {
      if (!request.headers.has(key)) {
        request.headers.append(key, value);
      }
    });
    return index.handleServerRequest(request);
  });
  return Object.assign(proxyFn, {
    url: functionUrl
  });
}
exports.createIncomingMessage = createIncomingMessage;
exports.createServerReference = createServerReference;
//# sourceMappingURL=index.cjs.map
